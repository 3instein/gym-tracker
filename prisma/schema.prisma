generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

// ============================================
// NextAuth.js Required Models
// ============================================

model User {
    id            String    @id @default(cuid())
    name          String?
    email         String    @unique
    emailVerified DateTime?
    image         String?
    createdAt     DateTime  @default(now())
    updatedAt     DateTime  @updatedAt

    // Auth relations
    accounts Account[]
    sessions Session[]

    // Gym tracker relations
    exercises       Exercise[]
    workoutSessions WorkoutSession[]
    workoutPlans    WorkoutPlan[]

    // Partner relations
    partners  Partner[] @relation("UserPartners")
    partnerOf Partner[] @relation("PartnerOfUser")
}

model Partner {
    id        String   @id @default(cuid())
    userId    String
    partnerId String
    createdAt DateTime @default(now())

    user    User @relation("UserPartners", fields: [userId], references: [id], onDelete: Cascade)
    partner User @relation("PartnerOfUser", fields: [partnerId], references: [id], onDelete: Cascade)

    @@unique([userId, partnerId])
    @@index([userId])
    @@index([partnerId])
}

model Account {
    id                String  @id @default(cuid())
    userId            String
    type              String
    provider          String
    providerAccountId String
    refresh_token     String? @db.Text
    access_token      String? @db.Text
    expires_at        Int?
    token_type        String?
    scope             String?
    id_token          String? @db.Text
    session_state     String?

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([provider, providerAccountId])
}

model Session {
    id           String   @id @default(cuid())
    sessionToken String   @unique
    userId       String
    expires      DateTime

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
    identifier String
    token      String   @unique
    expires    DateTime

    @@unique([identifier, token])
}

// ============================================
// Gym Tracker Domain Models
// ============================================

/// Exercise template that users can add to workouts
model Exercise {
    id          String   @id @default(cuid())
    userId      String
    name        String
    category    Category
    description String?
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    user             User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
    sets             Set[]
    workoutPlanItems WorkoutPlanExercise[]

    @@unique([userId, name])
    @@index([userId])
    @@index([category])
}

/// A workout session representing a single gym visit
model WorkoutSession {
    id        String        @id @default(cuid())
    userId    String
    name      String?
    date      DateTime      @db.Date
    duration  Int? // Duration in minutes
    notes     String?
    status    WorkoutStatus @default(IN_PROGRESS)
    createdAt DateTime      @default(now())
    updatedAt DateTime      @updatedAt
    planId    String?

    user User         @relation(fields: [userId], references: [id], onDelete: Cascade)
    plan WorkoutPlan? @relation(fields: [planId], references: [id])
    sets Set[]

    @@index([userId])
    @@index([date])
    @@index([status])
}

/// Individual set within a workout session
model Set {
    id               String   @id @default(cuid())
    workoutSessionId String
    exerciseId       String
    setNumber        Int // Order of set (1, 2, 3...)
    reps             Int
    weight           Decimal  @db.Decimal(6, 2) // Weight in kg/lbs
    rpe              Int? // Rate of Perceived Exertion (1-10)
    notes            String?
    isWarmup         Boolean  @default(false)
    createdAt        DateTime @default(now())

    workoutSession WorkoutSession @relation(fields: [workoutSessionId], references: [id], onDelete: Cascade)
    exercise       Exercise       @relation(fields: [exerciseId], references: [id], onDelete: Cascade)

    @@index([workoutSessionId])
    @@index([exerciseId])
}

/// A workout plan template that users can reuse
model WorkoutPlan {
    id          String   @id @default(cuid())
    userId      String
    name        String
    description String?
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    user            User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
    exercises       WorkoutPlanExercise[]
    workoutSessions WorkoutSession[]

    day Day? // Optional assigned day

    @@index([userId])
}

/// Exercises included in a workout plan
model WorkoutPlanExercise {
    id            String @id @default(cuid())
    workoutPlanId String
    exerciseId    String
    order         Int // Order of exercise in the plan

    workoutPlan WorkoutPlan @relation(fields: [workoutPlanId], references: [id], onDelete: Cascade)
    exercise    Exercise    @relation(fields: [exerciseId], references: [id], onDelete: Cascade)

    @@unique([workoutPlanId, exerciseId])
    @@index([workoutPlanId])
}

// ============================================
// Enums
// ============================================

enum Day {
    MONDAY
    TUESDAY
    WEDNESDAY
    THURSDAY
    FRIDAY
    SATURDAY
    SUNDAY
}

enum Category {
    CHEST
    BACK
    SHOULDERS
    BICEPS
    TRICEPS
    LEGS
    CORE
    CARDIO
    FULL_BODY
    OTHER
}

enum WorkoutStatus {
    IN_PROGRESS
    COMPLETED
    CANCELLED
}
